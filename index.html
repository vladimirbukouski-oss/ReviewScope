<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û—Ç–∑—ã–≤–æ—Å–∫–æ–ø - –ò–ò –ê–Ω–∞–ª–∏–∑ –æ—Ç–∑—ã–≤–æ–≤</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Onest:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
          --bg-primary: #0a0a0f;
          --bg-secondary: #12121a;
          --bg-tertiary: #1a1a24;
          --bg-card: #16161f;
          --text-primary: #f0f0f5;
          --text-secondary: #9090a0;
          --text-muted: #606070;
          --accent-primary: #6366f1;
          --accent-secondary: #8b5cf6;
          --accent-glow: rgba(99, 102, 241, 0.3);
          --success: #4ade80;
          --warning: #facc15;
          --danger: #f87171;
          --border: rgba(255, 255, 255, 0.06);
          --gradient-main: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #a855f7 100%);
        }

        body {
          font-family: 'Onest', -apple-system, sans-serif;
          background: var(--bg-primary);
          color: var(--text-primary);
          min-height: 100vh;
        }

        .app { min-height: 100vh; position: relative; }

        .app::before {
          content: '';
          position: fixed;
          top: 0; left: 0; right: 0;
          height: 600px;
          background: radial-gradient(ellipse 80% 50% at 50% -20%, rgba(99, 102, 241, 0.15), transparent);
          pointer-events: none;
        }

        .container {
          max-width: 1400px;
          margin: 0 auto;
          padding: 0 24px;
          position: relative;
          z-index: 1;
        }

        .header {
          padding: 24px 0;
          border-bottom: 1px solid var(--border);
          backdrop-filter: blur(20px);
          position: sticky;
          top: 0;
          z-index: 100;
          background: rgba(10, 10, 15, 0.8);
        }

        .header-content {
          display: flex;
          align-items: center;
          justify-content: space-between;
        }

        .logo {
          display: flex;
          align-items: center;
          gap: 12px;
        }

        .logo-icon {
          width: 44px;
          height: 44px;
          background: var(--gradient-main);
          border-radius: 12px;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 22px;
          box-shadow: 0 4px 20px var(--accent-glow);
        }

        .logo-text {
          font-size: 24px;
          font-weight: 700;
          background: var(--gradient-main);
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
        }

        .logo-badge {
          font-size: 10px;
          font-weight: 600;
          padding: 4px 8px;
          background: rgba(99, 102, 241, 0.2);
          border: 1px solid rgba(99, 102, 241, 0.3);
          border-radius: 6px;
          color: var(--accent-primary);
          text-transform: uppercase;
        }

        .service-badges { display: flex; gap: 8px; }

        .service-badge {
          padding: 8px 16px;
          background: var(--bg-tertiary);
          border: 1px solid var(--border);
          border-radius: 8px;
          font-size: 13px;
          font-weight: 500;
          color: var(--text-secondary);
        }

        .service-badge.wb { border-color: rgba(203, 17, 171, 0.3); color: #cb11ab; }
        .service-badge.onliner { border-color: rgba(255, 193, 7, 0.3); color: #ffc107; }

        .input-section { padding: 48px 0; }

        .input-card {
          background: var(--bg-secondary);
          border: 1px solid var(--border);
          border-radius: 20px;
          padding: 32px;
          position: relative;
        }

        .input-card::before {
          content: '';
          position: absolute;
          top: 0; left: 0; right: 0;
          height: 1px;
          background: linear-gradient(90deg, transparent, var(--accent-primary), transparent);
          opacity: 0.5;
        }

        .input-label {
          font-size: 14px;
          font-weight: 500;
          color: var(--text-secondary);
          margin-bottom: 12px;
          display: block;
        }

        .input-wrapper { display: flex; gap: 12px; }

        .url-input {
          flex: 1;
          background: var(--bg-tertiary);
          border: 1px solid var(--border);
          border-radius: 12px;
          padding: 16px 20px;
          font-size: 15px;
          color: var(--text-primary);
          font-family: 'JetBrains Mono', monospace;
          transition: all 0.2s ease;
        }

        .url-input:focus {
          outline: none;
          border-color: var(--accent-primary);
          box-shadow: 0 0 0 3px var(--accent-glow);
        }

        .url-input::placeholder { color: var(--text-muted); }

        .analyze-btn {
          background: var(--gradient-main);
          border: none;
          border-radius: 12px;
          padding: 16px 32px;
          font-size: 15px;
          font-weight: 600;
          color: white;
          cursor: pointer;
          transition: all 0.3s ease;
          display: flex;
          align-items: center;
          gap: 8px;
          white-space: nowrap;
        }

        .analyze-btn:hover {
          transform: translateY(-2px);
          box-shadow: 0 8px 30px var(--accent-glow);
        }

        .analyze-btn:disabled {
          opacity: 0.6;
          cursor: not-allowed;
          transform: none;
        }

        .spinner {
          width: 18px;
          height: 18px;
          border: 2px solid rgba(255,255,255,0.3);
          border-top-color: white;
          border-radius: 50%;
          animation: spin 0.8s linear infinite;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        .error-banner {
          background: rgba(248, 113, 113, 0.1);
          border: 1px solid rgba(248, 113, 113, 0.3);
          border-radius: 12px;
          padding: 16px 20px;
          margin-top: 16px;
          color: var(--danger);
          font-size: 14px;
        }

        .tabs {
          display: flex;
          gap: 4px;
          padding: 4px;
          background: var(--bg-secondary);
          border-radius: 14px;
          margin-bottom: 32px;
          width: fit-content;
        }

        .tab {
          padding: 12px 24px;
          background: transparent;
          border: none;
          border-radius: 10px;
          font-size: 14px;
          font-weight: 500;
          color: var(--text-secondary);
          cursor: pointer;
          transition: all 0.2s ease;
        }

        .tab:hover { color: var(--text-primary); }

        .tab.active {
          background: var(--bg-tertiary);
          color: var(--text-primary);
          box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .main-grid {
          display: grid;
          grid-template-columns: 1fr 400px;
          gap: 24px;
          padding-bottom: 48px;
        }

        @media (max-width: 1100px) { .main-grid { grid-template-columns: 1fr; } }

        .summary-section { display: flex; flex-direction: column; gap: 24px; }

        .score-card {
          background: var(--bg-secondary);
          border: 1px solid var(--border);
          border-radius: 20px;
          padding: 32px;
          display: flex;
          align-items: center;
          gap: 32px;
        }

        @media (max-width: 768px) { .score-card { flex-direction: column; text-align: center; } }

        .score-circle {
          position: relative;
          width: 140px;
          height: 140px;
          flex-shrink: 0;
        }

        .score-circle svg { transform: rotate(-90deg); width: 100%; height: 100%; }
        .score-circle .bg { fill: none; stroke: var(--bg-tertiary); stroke-width: 8; }
        .score-circle .progress {
          fill: none;
          stroke: url(#scoreGradient);
          stroke-width: 8;
          stroke-linecap: round;
          stroke-dasharray: 377;
          stroke-dashoffset: calc(377 - (377 * var(--progress) / 100));
          transition: stroke-dashoffset 1.5s ease-out;
        }

        .score-value {
          position: absolute;
          top: 50%; left: 50%;
          transform: translate(-50%, -50%);
          text-align: center;
        }

        .score-number {
          font-size: 42px;
          font-weight: 800;
          background: var(--gradient-main);
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
        }

        .score-label { font-size: 13px; color: var(--text-muted); }
        .score-info { flex: 1; }
        .score-title { font-size: 20px; font-weight: 600; margin-bottom: 8px; }
        .score-subtitle { font-size: 14px; color: var(--text-secondary); line-height: 1.6; }

        .score-stats { display: flex; gap: 24px; margin-top: 20px; flex-wrap: wrap; }
        .stat-item { display: flex; flex-direction: column; gap: 4px; }
        .stat-value { font-size: 18px; font-weight: 600; }
        .stat-value.success { color: var(--success); }
        .stat-value.warning { color: var(--warning); }
        .stat-label { font-size: 12px; color: var(--text-muted); }

        .pros-cons-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
        @media (max-width: 768px) { .pros-cons-grid { grid-template-columns: 1fr; } }

        .list-card {
          background: var(--bg-secondary);
          border: 1px solid var(--border);
          border-radius: 16px;
          padding: 24px;
        }

        .list-card.pros { border-left: 3px solid var(--success); }
        .list-card.cons { border-left: 3px solid var(--danger); }

        .list-header { display: flex; align-items: center; gap: 10px; margin-bottom: 16px; }

        .list-icon {
          width: 28px; height: 28px;
          border-radius: 8px;
          display: flex; align-items: center; justify-content: center;
          font-size: 14px;
        }

        .list-icon.pros { background: rgba(74, 222, 128, 0.15); }
        .list-icon.cons { background: rgba(248, 113, 113, 0.15); }
        .list-title { font-size: 16px; font-weight: 600; }
        .list-items { display: flex; flex-direction: column; gap: 12px; }

        .list-item {
          display: flex;
          align-items: flex-start;
          gap: 12px;
          padding: 12px;
          background: var(--bg-tertiary);
          border-radius: 10px;
          transition: all 0.2s ease;
        }

        .list-item:hover {
          background: rgba(99, 102, 241, 0.1);
          transform: translateX(4px);
        }

        .item-bullet {
          width: 6px; height: 6px;
          border-radius: 50%;
          margin-top: 6px;
          flex-shrink: 0;
        }

        .item-bullet.pros { background: var(--success); }
        .item-bullet.cons { background: var(--danger); }
        .item-content { flex: 1; }
        .item-text { font-size: 14px; line-height: 1.5; color: var(--text-primary); }
        .item-evidence { font-size: 11px; color: var(--text-muted); margin-top: 6px; font-family: 'JetBrains Mono', monospace; }

        .aspects-card {
          background: var(--bg-secondary);
          border: 1px solid var(--border);
          border-radius: 16px;
          padding: 24px;
        }

        .aspects-header { font-size: 16px; font-weight: 600; margin-bottom: 16px; }

        .aspect-item {
          padding: 16px;
          background: var(--bg-tertiary);
          border-radius: 12px;
          margin-bottom: 12px;
          transition: all 0.2s ease;
        }

        .aspect-item:hover { background: rgba(99, 102, 241, 0.1); }
        .aspect-item:last-child { margin-bottom: 0; }
        .aspect-top { display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; }
        .aspect-name { font-size: 14px; font-weight: 500; }
        .aspect-mentions { font-size: 12px; color: var(--text-muted); padding: 4px 8px; background: var(--bg-card); border-radius: 6px; }
        .aspect-summary { font-size: 13px; color: var(--text-secondary); line-height: 1.5; }

        .recommendations { display: flex; gap: 16px; flex-wrap: wrap; }
        .rec-card { flex: 1; min-width: 200px; padding: 16px; background: var(--bg-tertiary); border-radius: 12px; }
        .rec-header { font-size: 12px; color: var(--text-muted); margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px; }
        .rec-list { display: flex; flex-direction: column; gap: 6px; }
        .rec-item { font-size: 13px; color: var(--text-secondary); display: flex; align-items: center; gap: 8px; }
        .rec-item::before { content: ''; width: 4px; height: 4px; background: var(--accent-primary); border-radius: 50%; }
        .rec-card.avoid .rec-item::before { background: var(--danger); }

        .chat-section {
          background: var(--bg-secondary);
          border: 1px solid var(--border);
          border-radius: 20px;
          display: flex;
          flex-direction: column;
          height: calc(100vh - 200px);
          min-height: 500px;
          position: sticky;
          top: 100px;
        }

        .chat-header { padding: 20px 24px; border-bottom: 1px solid var(--border); }
        .chat-title { font-size: 16px; font-weight: 600; display: flex; align-items: center; gap: 8px; }
        .chat-title span { color: var(--accent-primary); }
        .chat-subtitle { font-size: 12px; color: var(--text-muted); margin-top: 4px; }

        .chat-messages {
          flex: 1;
          overflow-y: auto;
          padding: 20px;
          display: flex;
          flex-direction: column;
          gap: 16px;
        }

        .chat-messages::-webkit-scrollbar { width: 6px; }
        .chat-messages::-webkit-scrollbar-track { background: transparent; }
        .chat-messages::-webkit-scrollbar-thumb { background: var(--bg-tertiary); border-radius: 3px; }

        .chat-message {
          display: flex;
          gap: 12px;
          opacity: 0;
          transform: translateY(10px);
          animation: fadeIn 0.3s ease forwards;
        }

        @keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }

        .chat-message.user { flex-direction: row-reverse; }

        .ai-avatar {
          width: 36px; height: 36px;
          background: var(--gradient-main);
          border-radius: 10px;
          display: flex; align-items: center; justify-content: center;
          font-size: 18px;
          flex-shrink: 0;
        }

        .message-content {
          max-width: 85%;
          padding: 14px 18px;
          border-radius: 16px;
          font-size: 14px;
          line-height: 1.6;
        }

        .chat-message.assistant .message-content { background: var(--bg-tertiary); border-top-left-radius: 4px; }
        .chat-message.user .message-content { background: var(--accent-primary); border-top-right-radius: 4px; }
        .message-text { white-space: pre-wrap; }

        .message-evidence { margin-top: 16px; display: flex; flex-direction: column; gap: 12px; }
        .evidence-header { font-size: 12px; color: var(--text-muted); margin-bottom: 4px; }

        .typing-indicator {
          display: flex; gap: 4px;
          padding: 14px 18px;
          background: var(--bg-tertiary);
          border-radius: 16px;
          width: fit-content;
        }

        .typing-dot {
          width: 8px; height: 8px;
          background: var(--text-muted);
          border-radius: 50%;
          animation: typing 1.4s ease-in-out infinite;
        }

        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing {
          0%, 60%, 100% { transform: translateY(0); opacity: 0.4; }
          30% { transform: translateY(-6px); opacity: 1; }
        }

        .chat-input-wrapper { padding: 16px 20px; border-top: 1px solid var(--border); }

        .quick-questions { display: flex; flex-wrap: wrap; gap: 8px; padding: 0 20px 12px; }

        .quick-btn {
          padding: 8px 14px;
          background: var(--bg-tertiary);
          border: 1px solid var(--border);
          border-radius: 8px;
          font-size: 12px;
          color: var(--text-secondary);
          cursor: pointer;
          transition: all 0.2s ease;
        }

        .quick-btn:hover {
          background: rgba(99, 102, 241, 0.1);
          border-color: var(--accent-primary);
          color: var(--text-primary);
        }

        .chat-input-container {
          display: flex; gap: 12px;
          background: var(--bg-tertiary);
          border: 1px solid var(--border);
          border-radius: 14px;
          padding: 4px;
          transition: all 0.2s ease;
        }

        .chat-input-container:focus-within {
          border-color: var(--accent-primary);
          box-shadow: 0 0 0 3px var(--accent-glow);
        }

        .chat-input {
          flex: 1;
          background: transparent;
          border: none;
          padding: 12px 16px;
          font-size: 14px;
          color: var(--text-primary);
          font-family: inherit;
        }

        .chat-input:focus { outline: none; }
        .chat-input::placeholder { color: var(--text-muted); }

        .send-btn {
          background: var(--gradient-main);
          border: none;
          border-radius: 10px;
          width: 44px; height: 44px;
          display: flex; align-items: center; justify-content: center;
          cursor: pointer;
          transition: all 0.2s ease;
        }

        .send-btn:hover { transform: scale(1.05); }
        .send-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        .send-btn svg { width: 20px; height: 20px; color: white; }

        .review-card {
          background: var(--bg-tertiary);
          border: 1px solid var(--border);
          border-radius: 14px;
          padding: 16px;
          transition: all 0.3s ease;
          cursor: pointer;
          animation: slideUp 0.4s ease forwards;
          opacity: 0;
        }

        @keyframes slideUp {
          to { opacity: 1; transform: translateY(0); }
          from { opacity: 0; transform: translateY(20px); }
        }

        .review-card:hover {
          transform: translateY(-2px) scale(1.01);
          box-shadow: 0 8px 30px rgba(0,0,0,0.3);
        }

        .review-card.evidence {
          border: 2px solid var(--accent-primary);
          box-shadow: 0 0 20px var(--accent-glow);
        }

        .review-card.pos { background: rgba(74, 222, 128, 0.1); border-color: rgba(74, 222, 128, 0.3); }
        .review-card.neg { background: rgba(248, 113, 113, 0.1); border-color: rgba(248, 113, 113, 0.3); }
        .review-card.neu { background: rgba(250, 204, 21, 0.1); border-color: rgba(250, 204, 21, 0.3); }

        .review-header {
          display: flex;
          align-items: center;
          justify-content: space-between;
          margin-bottom: 12px;
          flex-wrap: wrap;
          gap: 8px;
        }

        .review-user { display: flex; align-items: center; gap: 10px; }

        .avatar {
          width: 36px; height: 36px;
          background: var(--gradient-main);
          border-radius: 10px;
          display: flex; align-items: center; justify-content: center;
          font-size: 14px; font-weight: 600; color: white;
        }

        .user-info { display: flex; flex-direction: column; }
        .user-info .name { font-size: 13px; font-weight: 500; }
        .user-info .date { font-size: 11px; color: var(--text-muted); }
        .review-meta { display: flex; align-items: center; gap: 12px; }

        .star-rating { display: flex; gap: 2px; }

        .trust-badge {
          display: flex; align-items: center; gap: 4px;
          padding: 4px 10px;
          background: rgba(74, 222, 128, 0.2);
          border-radius: 6px;
          font-size: 11px; font-weight: 500;
          color: var(--success);
        }

        .review-text { font-size: 13px; line-height: 1.6; color: var(--text-secondary); }

        .evidence-tag {
          margin-top: 12px;
          font-size: 10px; font-weight: 600;
          text-transform: uppercase;
          letter-spacing: 0.5px;
          color: var(--accent-primary);
          padding: 4px 8px;
          background: rgba(99, 102, 241, 0.15);
          border-radius: 4px;
          width: fit-content;
        }

        .reviews-section { display: flex; flex-direction: column; gap: 16px; }
        .reviews-header { display: flex; align-items: center; justify-content: space-between; }
        .reviews-title { font-size: 18px; font-weight: 600; }
        .reviews-count { font-size: 13px; color: var(--text-muted); }
        .reviews-grid { display: grid; gap: 16px; }

        .load-more-btn {
          background: var(--bg-tertiary);
          border: 1px solid var(--border);
          border-radius: 12px;
          padding: 14px 24px;
          font-size: 14px; font-weight: 500;
          color: var(--text-secondary);
          cursor: pointer;
          transition: all 0.2s ease;
          width: 100%;
        }

        .load-more-btn:hover {
          background: rgba(99, 102, 241, 0.1);
          border-color: var(--accent-primary);
          color: var(--text-primary);
        }

        .sentiment-bar-container { margin-top: 20px; }
        .sentiment-bar {
          height: 8px;
          background: var(--bg-tertiary);
          border-radius: 4px;
          display: flex;
          overflow: hidden;
        }

        .sentiment-bar .segment { transition: width 1s ease-out; }
        .sentiment-bar .segment.neg { background: var(--danger); }
        .sentiment-bar .segment.neu { background: var(--warning); }
        .sentiment-bar .segment.pos { background: var(--success); }

        .sentiment-labels { display: flex; justify-content: space-between; margin-top: 8px; }
        .sentiment-labels .label { font-size: 11px; }
        .sentiment-labels .label.neg { color: var(--danger); }
        .sentiment-labels .label.neu { color: var(--warning); }
        .sentiment-labels .label.pos { color: var(--success); }

        .loading-overlay {
          position: fixed;
          top: 0; left: 0; right: 0; bottom: 0;
          background: rgba(10, 10, 15, 0.95);
          display: flex; align-items: center; justify-content: center;
          z-index: 1000;
        }

        .loading-content { text-align: center; }

        .loading-spinner {
          width: 60px; height: 60px;
          border: 3px solid var(--bg-tertiary);
          border-top-color: var(--accent-primary);
          border-radius: 50%;
          animation: spin 1s linear infinite;
          margin: 0 auto 24px;
        }

        .loading-text { font-size: 18px; font-weight: 500; margin-bottom: 8px; }
        .loading-subtext { font-size: 14px; color: var(--text-muted); }
        .loading-progress { margin-top: 24px; width: 300px; }

        .progress-bar {
          height: 4px;
          background: var(--bg-tertiary);
          border-radius: 2px;
          overflow: hidden;
        }

        .progress-fill {
          height: 100%;
          background: var(--gradient-main);
          transition: width 0.5s ease-out;
        }

        .progress-steps {
          display: flex;
          justify-content: space-between;
          margin-top: 12px;
          font-size: 11px;
          color: var(--text-muted);
        }

        .progress-steps .step.done { color: var(--success); }
        .progress-steps .step.active { color: var(--accent-primary); font-weight: 600; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;

        const API_BASE = 'https://reviewscope-api-production.up.railway.app';

        // API
        const api = {
          async analyze(url) {
            const res = await fetch(`${API_BASE}/analyze`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ url, use_cache: true })
            });
            if (!res.ok) throw new Error(await res.text());
            return res.json();
          },

          async getStatus(sessionId) {
            const res = await fetch(`${API_BASE}/status/${sessionId}`);
            if (!res.ok) throw new Error(await res.text());
            return res.json();
          },

          async getSummary(sessionId) {
            const res = await fetch(`${API_BASE}/summary/${sessionId}`);
            if (!res.ok) throw new Error(await res.text());
            return res.json();
          },

          async chat(sessionId, question) {
            const res = await fetch(`${API_BASE}/chat/${sessionId}`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ session_id: sessionId, question })
            });
            if (!res.ok) throw new Error(await res.text());
            return res.json();
          },

          async getReviews(sessionId, skip = 0, limit = 20) {
            const res = await fetch(`${API_BASE}/reviews/${sessionId}?skip=${skip}&limit=${limit}`);
            if (!res.ok) throw new Error(await res.text());
            return res.json();
          }
        };

        // Components
        const StarRating = ({ rating, size = 20 }) => (
          <div className="star-rating">
            {[1,2,3,4,5].map(i => (
              <svg key={i} width={size} height={size} viewBox="0 0 24 24" fill={i <= Math.round(rating) ? '#FFB800' : '#2a2a3a'}>
                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
              </svg>
            ))}
          </div>
        );

        const ReviewCard = ({ review, isEvidence }) => (
          <div className={`review-card ${review.sentiment || 'neu'} ${isEvidence ? 'evidence' : ''}`}>
            <div className="review-header">
              <div className="review-user">
                <div className="avatar">{(review.user || 'A')[0].toUpperCase()}</div>
                <div className="user-info">
                  <span className="name">{review.user || '–ü–æ–∫—É–ø–∞—Ç–µ–ª—å'}</span>
                  <span className="date">{review.created || ''}</span>
                </div>
              </div>
              <div className="review-meta">
                <StarRating rating={review.rating || 0} size={14} />
                <div className="trust-badge">
                  <span>‚úì</span>
                  <span>{Math.round((review.trust || 0.5) * 100)}%</span>
                </div>
              </div>
            </div>
            <p className="review-text">{review.text}</p>
            {isEvidence && <div className="evidence-tag">üìé –î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ</div>}
          </div>
        );

        const ChatMessage = ({ message }) => {
          const isUser = message.role === 'user';
          return (
            <div className={`chat-message ${isUser ? 'user' : 'assistant'}`}>
              {!isUser && <div className="ai-avatar">üîç</div>}
              <div className="message-content">
                <div className="message-text">{message.content}</div>
                {message.evidence && message.evidence.length > 0 && (
                  <div className="message-evidence">
                    <div className="evidence-header">üìé –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—â–∏–µ –æ—Ç–∑—ã–≤—ã:</div>
                    {message.evidence.map((review, i) => (
                      <ReviewCard key={i} review={review} isEvidence />
                    ))}
                  </div>
                )}
              </div>
            </div>
          );
        };

        const SentimentBar = ({ mix }) => {
          if (!mix) return null;
          return (
            <div className="sentiment-bar-container">
              <div className="sentiment-bar">
                <div className="segment neg" style={{ width: `${(mix.neg || 0) * 100}%` }} />
                <div className="segment neu" style={{ width: `${(mix.neu || 0) * 100}%` }} />
                <div className="segment pos" style={{ width: `${(mix.pos || 0) * 100}%` }} />
              </div>
              <div className="sentiment-labels">
                <span className="label neg">{Math.round((mix.neg || 0) * 100)}% –Ω–µ–≥–∞—Ç–∏–≤</span>
                <span className="label neu">{Math.round((mix.neu || 0) * 100)}% –Ω–µ–π—Ç—Ä–∞–ª</span>
                <span className="label pos">{Math.round((mix.pos || 0) * 100)}% –ø–æ–∑–∏—Ç–∏–≤</span>
              </div>
            </div>
          );
        };

        const LoadingOverlay = ({ progress, message }) => (
          <div className="loading-overlay">
            <div className="loading-content">
              <div className="loading-spinner" />
              <div className="loading-text">{message || '–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –æ—Ç–∑—ã–≤—ã'}</div>
              <div className="loading-subtext">–û–±—ã—á–Ω–æ —ç—Ç–æ –∑–∞–Ω–∏–º–∞–µ—Ç 30-90 —Å–µ–∫—É–Ω–¥</div>
              <div className="loading-progress">
                <div className="progress-bar">
                  <div className="progress-fill" style={{ width: `${progress}%` }} />
                </div>
                <div className="progress-steps">
                  <span className={`step ${progress >= 30 ? 'done' : progress > 0 ? 'active' : ''}`}>–°–±–æ—Ä</span>
                  <span className={`step ${progress >= 60 ? 'done' : progress >= 30 ? 'active' : ''}`}>–ê–Ω–∞–ª–∏–∑</span>
                  <span className={`step ${progress >= 80 ? 'done' : progress >= 60 ? 'active' : ''}`}>–ò–Ω–¥–µ–∫—Å</span>
                  <span className={`step ${progress >= 100 ? 'done' : progress >= 80 ? 'active' : ''}`}>–°–≤–æ–¥–∫–∞</span>
                </div>
              </div>
            </div>
          </div>
        );

        // Main App
        function App() {
          const [activeTab, setActiveTab] = useState('summary');
          const [url, setUrl] = useState('');
          const [isAnalyzing, setIsAnalyzing] = useState(false);
          const [analysisStatus, setAnalysisStatus] = useState({ progress: 0, message: '' });
          const [sessionId, setSessionId] = useState(null);
          const [hasData, setHasData] = useState(false);
          const [product, setProduct] = useState(null);
          const [summary, setSummary] = useState(null);
          const [reviews, setReviews] = useState([]);
          const [chatMessages, setChatMessages] = useState([]);
          const [chatInput, setChatInput] = useState('');
          const [isTyping, setIsTyping] = useState(false);
          const [error, setError] = useState(null);
          const chatEndRef = useRef(null);

          useEffect(() => {
            chatEndRef.current?.scrollIntoView({ behavior: 'smooth' });
          }, [chatMessages]);

          // Poll status
          useEffect(() => {
            let interval;
            if (isAnalyzing && sessionId) {
              interval = setInterval(async () => {
                try {
                  const status = await api.getStatus(sessionId);
                  setAnalysisStatus(status);

                  if (status.status === 'ready') {
                    setIsAnalyzing(false);
                    const data = await api.getSummary(sessionId);
                    setProduct(data.product);
                    setSummary(data.summary);
                    setReviews(data.reviews || []);
                    setHasData(true);
                    setChatMessages([{
                      role: 'assistant',
                      content: `üéâ –ì–æ—Ç–æ–≤–æ! –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª ${data.product?.keptReviews || 0} –æ—Ç–∑—ã–≤–æ–≤. –°–ø—Ä–∞—à–∏–≤–∞–π—Ç–µ —á—Ç–æ —É–≥–æ–¥–Ω–æ!`
                    }]);
                  } else if (status.status === 'error') {
                    setIsAnalyzing(false);
                    setError(status.message);
                  }
                } catch (err) {
                  console.error(err);
                }
              }, 2000);
            }
            return () => clearInterval(interval);
          }, [isAnalyzing, sessionId]);

          const handleAnalyze = async () => {
            if (!url.trim()) return;
            setError(null);
            setIsAnalyzing(true);
            setHasData(false);
            setAnalysisStatus({ progress: 0, message: '–ó–∞–ø—É—Å–∫...' });

            try {
              const result = await api.analyze(url);
              setSessionId(result.session_id);

              if (result.status === 'ready') {
                const data = await api.getSummary(result.session_id);
                setProduct(data.product);
                setSummary(data.summary);
                setReviews(data.reviews || []);
                setHasData(true);
                setIsAnalyzing(false);
                setChatMessages([{ role: 'assistant', content: `üì¶ –ó–∞–≥—Ä—É–∂–µ–Ω–æ –∏–∑ –∫—ç—à–∞! ${data.product?.keptReviews || 0} –æ—Ç–∑—ã–≤–æ–≤.` }]);
              }
            } catch (err) {
              setIsAnalyzing(false);
              setError(err.message);
            }
          };

          const handleSendMessage = async () => {
            if (!chatInput.trim() || !sessionId) return;

            const question = chatInput.trim();
            setChatMessages(prev => [...prev, { role: 'user', content: question }]);
            setChatInput('');
            setIsTyping(true);

            try {
              const response = await api.chat(sessionId, question);
              setChatMessages(prev => [...prev, {
                role: 'assistant',
                content: response.answer,
                evidence: response.evidence || []
              }]);
            } catch (err) {
              setChatMessages(prev => [...prev, { role: 'assistant', content: `‚ùå –û—à–∏–±–∫–∞: ${err.message}` }]);
            } finally {
              setIsTyping(false);
            }
          };

          const loadMoreReviews = async () => {
            if (!sessionId) return;
            try {
              const data = await api.getReviews(sessionId, reviews.length, 20);
              setReviews(prev => [...prev, ...data.reviews]);
            } catch (err) {
              console.error(err);
            }
          };

          return (
            <div className="app">
              <svg width="0" height="0">
                <defs>
                  <linearGradient id="scoreGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                    <stop offset="0%" stopColor="#6366f1" />
                    <stop offset="50%" stopColor="#8b5cf6" />
                    <stop offset="100%" stopColor="#a855f7" />
                  </linearGradient>
                </defs>
              </svg>

              <header className="header">
                <div className="container">
                  <div className="header-content">
                    <div className="logo">
                      <div className="logo-icon">üîç</div>
                      <span className="logo-text">–û—Ç–∑—ã–≤–æ—Å–∫–æ–ø</span>
                      <span className="logo-badge">–ò–ò</span>
                    </div>
                    <div className="service-badges">
                      <span className="service-badge wb">Wildberries</span>
                      <span className="service-badge onliner">Onl√≠ner</span>
                    </div>
                  </div>
                </div>
              </header>

              <div className="container">
                <section className="input-section">
                  <div className="input-card">
                    <label className="input-label" htmlFor="url-input">–í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ —Ç–æ–≤–∞—Ä</label>
                    <div className="input-wrapper">
                      <input
                        type="text"
                        id="url-input"
                        className="url-input"
                        placeholder="https://www.wildberries.ru/catalog/123456789/detail.aspx"
                        value={url}
                        onChange={(e) => setUrl(e.target.value)}
                        onKeyPress={(e) => e.key === 'Enter' && handleAnalyze()}
                      />
                      <button className="analyze-btn" onClick={handleAnalyze} disabled={isAnalyzing || !url.trim()}>
                        {isAnalyzing ? <><div className="spinner" /> –ê–Ω–∞–ª–∏–∑–∏—Ä—É—é...</> : <>‚ú® –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å</>}
                      </button>
                    </div>
                    {error && <div className="error-banner">‚ö†Ô∏è {error}</div>}
                  </div>
                </section>

                {hasData && (
                  <>
                    <div className="tabs">
                      <button className={`tab ${activeTab === 'summary' ? 'active' : ''}`} onClick={() => setActiveTab('summary')}>üìä –°–≤–æ–¥–∫–∞</button>
                      <button className={`tab ${activeTab === 'reviews' ? 'active' : ''}`} onClick={() => setActiveTab('reviews')}>üí¨ –û—Ç–∑—ã–≤—ã</button>
                    </div>

                    <div className="main-grid">
                      <div className="summary-section">
                        {activeTab === 'summary' && summary && (
                          <>
                            <div className="score-card">
                              <div className="score-circle" style={{ '--progress': ((summary.score?.value || 0) / 5) * 100 }}>
                                <svg viewBox="0 0 128 128">
                                  <circle className="bg" cx="64" cy="64" r="60" />
                                  <circle className="progress" cx="64" cy="64" r="60" />
                                </svg>
                                <div className="score-value">
                                  <div className="score-number">{(summary.score?.value || 0).toFixed(1)}</div>
                                  <div className="score-label">–∏–∑ 5</div>
                                </div>
                              </div>
                              <div className="score-info">
                                <h2 className="score-title">–†–µ–∞–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥</h2>
                                <p className="score-subtitle">{summary.one_liner || ''}</p>
                                <div className="score-stats">
                                  <div className="stat-item">
                                    <span className="stat-value success">{product?.keptReviews || 0}</span>
                                    <span className="stat-label">–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ</span>
                                  </div>
                                  <div className="stat-item">
                                    <span className="stat-value warning">{Math.round((product?.suspiciousShare || 0) * 100)}%</span>
                                    <span className="stat-label">–ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö</span>
                                  </div>
                                </div>
                                <SentimentBar mix={product?.sentimentMix} />
                              </div>
                            </div>

                            <div className="pros-cons-grid">
                              <div className="list-card pros">
                                <div className="list-header">
                                  <div className="list-icon pros">üëç</div>
                                  <h3 className="list-title">–ü–ª—é—Å—ã</h3>
                                </div>
                                <div className="list-items">
                                  {(summary.pros || []).map((pro, i) => (
                                    <div key={i} className="list-item">
                                      <div className="item-bullet pros" />
                                      <div className="item-content">
                                        <p className="item-text">{pro.point}</p>
                                        <span className="item-evidence">{(pro.evidence_ids || []).length} –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π</span>
                                      </div>
                                    </div>
                                  ))}
                                </div>
                              </div>

                              <div className="list-card cons">
                                <div className="list-header">
                                  <div className="list-icon cons">üëé</div>
                                  <h3 className="list-title">–ú–∏–Ω—É—Å—ã</h3>
                                </div>
                                <div className="list-items">
                                  {(summary.cons || []).map((con, i) => (
                                    <div key={i} className="list-item">
                                      <div className="item-bullet cons" />
                                      <div className="item-content">
                                        <p className="item-text">{con.point}</p>
                                        <span className="item-evidence">{(con.evidence_ids || []).length} –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π</span>
                                      </div>
                                    </div>
                                  ))}
                                </div>
                              </div>
                            </div>

                            {summary.aspects && summary.aspects.length > 0 && (
                              <div className="aspects-card">
                                <h3 className="aspects-header">üìã –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑</h3>
                                {summary.aspects.map((aspect, i) => (
                                  <div key={i} className="aspect-item">
                                    <div className="aspect-top">
                                      <span className="aspect-name">{aspect.aspect}</span>
                                      <span className="aspect-mentions">{aspect.mentions || 0} —É–ø–æ–º.</span>
                                    </div>
                                    <p className="aspect-summary">{aspect.summary}</p>
                                  </div>
                                ))}
                              </div>
                            )}

                            {(summary.who_it_is_for || summary.who_should_avoid) && (
                              <div className="recommendations">
                                {summary.who_it_is_for?.length > 0 && (
                                  <div className="rec-card">
                                    <div className="rec-header">‚úÖ –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è</div>
                                    <div className="rec-list">
                                      {summary.who_it_is_for.map((item, i) => <div key={i} className="rec-item">{item}</div>)}
                                    </div>
                                  </div>
                                )}
                                {summary.who_should_avoid?.length > 0 && (
                                  <div className="rec-card avoid">
                                    <div className="rec-header">‚ö†Ô∏è –ù–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è</div>
                                    <div className="rec-list">
                                      {summary.who_should_avoid.map((item, i) => <div key={i} className="rec-item">{item}</div>)}
                                    </div>
                                  </div>
                                )}
                              </div>
                            )}
                          </>
                        )}

                        {activeTab === 'reviews' && (
                          <div className="reviews-section">
                            <div className="reviews-header">
                              <h2 className="reviews-title">–ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –æ—Ç–∑—ã–≤—ã</h2>
                              <span className="reviews-count">{reviews.length} –∏–∑ {product?.keptReviews || 0}</span>
                            </div>
                            <div className="reviews-grid">
                              {reviews.map((review, i) => <ReviewCard key={review.id || i} review={review} />)}
                            </div>
                            {reviews.length < (product?.keptReviews || 0) && (
                              <button className="load-more-btn" onClick={loadMoreReviews}>–ó–∞–≥—Ä—É–∑–∏—Ç—å –µ—â—ë</button>
                            )}
                          </div>
                        )}
                      </div>

                      <div className="chat-section">
                        <div className="chat-header">
                          <h3 className="chat-title"><span>üí¨</span> –°–ø—Ä–æ—Å–∏—Ç–µ –æ —Ç–æ–≤–∞—Ä–µ</h3>
                          <p className="chat-subtitle">AI –Ω–∞ –æ—Å–Ω–æ–≤–µ {product?.keptReviews || 0} –æ—Ç–∑—ã–≤–æ–≤</p>
                        </div>

                        <div className="chat-messages">
                          {chatMessages.map((msg, i) => <ChatMessage key={i} message={msg} />)}
                          {isTyping && (
                            <div className="chat-message assistant">
                              <div className="ai-avatar">üîç</div>
                              <div className="typing-indicator">
                                <div className="typing-dot" />
                                <div className="typing-dot" />
                                <div className="typing-dot" />
                              </div>
                            </div>
                          )}
                          <div ref={chatEndRef} />
                        </div>

                        <div className="quick-questions">
                          <button className="quick-btn" onClick={() => setChatInput('–ö–∞–∫–∏–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–ª—é—Å—ã?')}>üëç –ü–ª—é—Å—ã</button>
                          <button className="quick-btn" onClick={() => setChatInput('–ö–∞–∫–∏–µ –º–∏–Ω—É—Å—ã?')}>üëé –ú–∏–Ω—É—Å—ã</button>
                          <button className="quick-btn" onClick={() => setChatInput('–°—Ç–æ–∏—Ç –ª–∏ —Å–≤–æ–∏—Ö –¥–µ–Ω–µ–≥?')}>üí∞ –¶–µ–Ω–∞/–∫–∞—á–µ—Å—Ç–≤–æ</button>
                        </div>

                        <div className="chat-input-wrapper">
                          <div className="chat-input-container">
                            <input
                              type="text"
                              className="chat-input"
                              placeholder="–ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å..."
                              value={chatInput}
                              onChange={(e) => setChatInput(e.target.value)}
                              onKeyPress={(e) => e.key === 'Enter' && handleSendMessage()}
                            />
                            <button className="send-btn" onClick={handleSendMessage} disabled={!chatInput.trim() || isTyping}>
                              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                                <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z" />
                              </svg>
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </>
                )}
              </div>

              {isAnalyzing && <LoadingOverlay progress={analysisStatus.progress} message={analysisStatus.message} />}
            </div>
          );
        }

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
